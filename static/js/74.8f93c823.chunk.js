(function(){(this||window).webpackJsonpareactgis.registerAbsMids({"esri/views/2d/engine/vectorTiles/Bucket":565,"esri/views/2d/engine/vectorTiles/BackgroundBucket":891,"esri/views/2d/engine/vectorTiles/CircleBucket":892,"esri/views/2d/engine/vectorTiles/FillBucket":893,"esri/views/2d/engine/vectorTiles/MemoryBuffer":894,"esri/views/2d/engine/vectorTiles/LineBucket":895,"esri/views/2d/engine/vectorTiles/Placement":896,"esri/views/2d/engine/vectorTiles/SymbolBucket":897,"esri/views/2d/tiling/enums":898,"esri/views/2d/engine/vectorTiles/WorkerTileHandler":1992,"esri/views/2d/engine/vectorTiles/WorkerTile":1993,"esri/views/2d/engine/vectorTiles/IndexMemoryBuffer":1994,"esri/views/2d/engine/vectorTiles/Conflict":1998,"esri/views/2d/engine/vectorTiles/TileParser":1999,"esri/views/2d/engine/vectorTiles/Feature":2e3,"esri/views/2d/engine/vectorTiles/SourceLayerData":2001,"esri/views/2d/engine/vectorTiles/VertexMemoryBuffer":2002})})(),(this.webpackJsonpareactgis=this.webpackJsonpareactgis||[]).push([[74],{1992:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(28),r(1993),r(899)],void 0===(i=function(e,t,r,n,i){return function(){function e(){this._tiles=new Map,this._spriteInfo={},this._glyphInfo={}}return e.prototype.reset=function(){this._spriteInfo={},this._glyphInfo={};var e=this._tiles;return e.forEach((function(e){return e.setObsolete()})),e.clear(),r.resolve()},e.prototype.getLayers=function(){return this._layers},e.prototype.setLayers=function(e){var t=new i(e);return this._layers=t.layers,r.resolve({data:""})},e.prototype.createTileAndParse=function(e,t){for(var r=this,i=e.key,o=new n,a={},s=0,l=Object.keys(e.sourceName2DataAndRefKey);s<l.length;s++){var u=l[s],f=e.sourceName2DataAndRefKey[u];a[u]=f.refKey}return o.initialize(i,a,this,e.rotation),o.setDataAndParse(e.sourceName2DataAndRefKey,t).then((function(e){return r._tiles.set(i,o),e})).catch((function(e){throw o.setObsolete(),o.release(),e}))},e.prototype.updateSymbols=function(e,t){var n=this._tiles.get(e.key);return n?n.updateSymbols(e.rotation,t):r.reject()},e.prototype.updateStyle=function(e,t){var n=new i(e);return this._layers=n.layers,this._tiles.forEach((function(e){e.reparse(t).then((function(r){t.client.invoke("updateTileData",{tileId:e.tileKey,tileData:r.result})}))})),r.resolve({data:""})},e.prototype.destructTileData=function(e){return this._tiles.has(e)&&(this._tiles.get(e).release(),this._tiles.delete(e)),r.resolve()},e.prototype.fetchSprites=function(e,t,n){var i=[],o=this._spriteInfo;return e.forEach((function(e){void 0===o[e]&&i.push(e)})),0===i.length?r.resolve():t.invoke("getSprites",i,{signal:n&&n.signal}).then((function(e){for(var t in e){var r=e[t];o[t]=r}}))},e.prototype.getSpriteItems=function(){return this._spriteInfo},e.prototype.fetchGlyphs=function(e,t,n,i,o){var a=[],s=this._glyphInfo[t];return s?n.forEach((function(e){s[e]||a.push(e)})):(s=this._glyphInfo[t]=[],n.forEach((function(e){return a.push(e)}))),0===a.length?r.resolve():i.invoke("getGlyphs",{tileID:e,font:t,codePoints:a},o).then((function(e){for(var t=0;t<e.length;t++)e[t]&&(s[t]=e[t])}))},e.prototype.getGlyphItems=function(e){return this._glyphInfo[e]},e}()}.apply(null,n))||(e.exports=i)},1993:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(31),r(32),r(33),r(28),r(891),r(892),r(893),r(334),r(1994),r(895),r(896),r(897),r(1999),r(2002),r(898)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,f,c,h,x,d,p,y){return function(){function e(){this.rotation=0,this.status=y.TileStatus.INITIALIZED,this._symbolBuckets=[],this.placementEngine=new h.PlacementEngine,this.fillVertexBuffer=new p.FillVertexBuffer(!1),this.fillDDVertexBuffer=new p.FillVertexBuffer(!0),this.fillIndexBuffer=new f.TriangleIndexBuffer,this.outlineVertexBuffer=new p.OutlineVertexBuffer(!1),this.outlineDDVertexBuffer=new p.OutlineVertexBuffer(!0),this.outlineIndexBuffer=new f.TriangleIndexBuffer,this.lineVertexBuffer=new p.LineVertexBuffer(!1),this.lineDDVertexBuffer=new p.LineVertexBuffer(!0),this.lineIndexBuffer=new f.TriangleIndexBuffer,this.iconVertexBuffer=new p.SymbolVertexBuffer(!1),this.iconDDVertexBuffer=new p.SymbolVertexBuffer(!0),this.iconIndexBuffer=new f.TriangleIndexBuffer,this.textVertexBuffer=new p.SymbolVertexBuffer(!1),this.textDDVertexBuffer=new p.SymbolVertexBuffer(!0),this.textIndexBuffer=new f.TriangleIndexBuffer,this.circleVertexBuffer=new p.CircleVertexBuffer,this.circleIndexBuffer=new f.TriangleIndexBuffer}return e.prototype.initialize=function(e,t,r,n){void 0===n&&(n=0),this.tileKey=e,this.refKeys=t,this._workerTileHandler=r,this.rotation=n,this.placementEngine.setAngle(u.C_DEG_TO_RAD*n)},e.prototype.release=function(){this.tileKey="",this.refKeys=null,this.status=y.TileStatus.INITIALIZED,this.rotation=0,this.resetData(),this._workerTileHandler=null},e.prototype.resetData=function(){this.fillVertexBuffer.reset(),this.fillDDVertexBuffer.reset(),this.fillIndexBuffer.reset(),this.outlineVertexBuffer.reset(),this.outlineDDVertexBuffer.reset(),this.outlineIndexBuffer.reset(),this.lineVertexBuffer.reset(),this.lineDDVertexBuffer.reset(),this.lineIndexBuffer.reset(),this.iconVertexBuffer.reset(),this.iconDDVertexBuffer.reset(),this.iconIndexBuffer.reset(),this.textVertexBuffer.reset(),this.textDDVertexBuffer.reset(),this.textIndexBuffer.reset(),this.circleVertexBuffer.reset(),this.circleIndexBuffer.reset(),this.placementEngine.reset(),this._symbolBuckets.length=0},e.prototype.reparse=function(e){return this.resetData(),this.setDataAndParse(this._data,e)},e.prototype.setDataAndParse=function(e,t){var r=this,n=t&&t.signal;if(i.isSome(n)){n.addEventListener("abort",(function e(){n.removeEventListener("abort",e),r.status=y.TileStatus.INVALID}))}return this._data=e,this._parse(e,t).then((function(e){r.status=y.TileStatus.READY;for(var t=[1,r.fillVertexBuffer.sizeInBytes,2,r.fillDDVertexBuffer.sizeInBytes,3,r.fillIndexBuffer.sizeInBytes,4,r.outlineVertexBuffer.sizeInBytes,5,r.outlineDDVertexBuffer.sizeInBytes,6,r.outlineIndexBuffer.sizeInBytes,7,r.lineVertexBuffer.sizeInBytes,8,r.lineDDVertexBuffer.sizeInBytes,9,r.lineIndexBuffer.sizeInBytes,10,r.iconVertexBuffer.sizeInBytes,11,r.iconDDVertexBuffer.sizeInBytes,12,r.iconIndexBuffer.sizeInBytes,13,r.textVertexBuffer.sizeInBytes,14,r.textDDVertexBuffer.sizeInBytes,15,r.textIndexBuffer.sizeInBytes,16,r.circleVertexBuffer.sizeInBytes,17,r.circleIndexBuffer.sizeInBytes],n=new Uint32Array(t),i=[],o=e.length,u=0;u<o;u++){var f=e[u];if(f instanceof l)i.push(f.layerIndex),i.push(1),i.push(f.fillIndexStart),i.push(f.fillIndexCount),i.push(f.outlineIndexStart),i.push(f.outlineIndexCount);else if(f instanceof c)i.push(f.layerIndex),i.push(2),i.push(f.lineIndexStart),i.push(f.lineIndexCount);else if(f instanceof x){i.push(f.layerIndex),i.push(3),i.push(f.sdfMarker?1:0);var h=f.markerPageMap;i.push(h.size),h.forEach((function(e,t){i.push(t),i.push(e[0]),i.push(e[1])}));var d=f.glyphsPageMap;i.push(d.size),d.forEach((function(e,t){i.push(t),i.push(e[0]),i.push(e[1])}))}else f instanceof s?(i.push(f.layerIndex),i.push(4),i.push(f.circleIndexStart),i.push(f.circleIndexCount)):f instanceof a&&(i.push(f.layerIndex),i.push(0))}var p=new Uint32Array(i),_=r.fillVertexBuffer.toBuffer(),v=r.fillDDVertexBuffer.toBuffer(),g=r.fillIndexBuffer.toBuffer(),m=r.outlineVertexBuffer.toBuffer(),I=r.outlineDDVertexBuffer.toBuffer(),V=r.outlineIndexBuffer.toBuffer(),B=r.lineVertexBuffer.toBuffer(),b=r.lineDDVertexBuffer.toBuffer(),D=r.lineIndexBuffer.toBuffer(),w=r.iconVertexBuffer.toBuffer(),P=r.iconDDVertexBuffer.toBuffer(),T=r.iconIndexBuffer.toBuffer(),E=r.textVertexBuffer.toBuffer(),M=r.textDDVertexBuffer.toBuffer(),z=r.textIndexBuffer.toBuffer(),C=r.circleVertexBuffer.toBuffer(),N=r.circleIndexBuffer.toBuffer();return{result:{bufferDataInfo:n.buffer,bucketDataInfo:p.buffer,bufferData:[_,v,g,m,I,V,B,b,D,w,P,T,E,M,z,C,N]},transferList:[_,v,g,m,I,V,B,b,D,w,P,T,E,M,z,C,N,n.buffer,p.buffer]}}))},e.prototype.addBucket=function(e){this._symbolBuckets.push(e)},e.prototype.updateSymbols=function(e,t){var r=this,n=this._symbolBuckets;if(!n||0===n.length)return o.resolve();var a=t&&t.signal;if(i.isSome(a)){a.addEventListener("abort",(function e(){a.removeEventListener("abort",e),r.status=y.TileStatus.INVALID}))}this.rotation=e;var s=this.placementEngine;s.reset(),s.setAngle(e/256*360*u.C_DEG_TO_RAD);var l=this.iconVertexBuffer;l.reset();var f=this.iconDDVertexBuffer;f.reset();var c=this.iconIndexBuffer;c.reset();var h=this.textVertexBuffer;h.reset();var x=this.textDDVertexBuffer;x.reset();var d=this.textIndexBuffer;d.reset();for(var p=[],_=0;_<n.length;_++){var v=n[_];if(v&&v.layer){var g=v.layer,m=v.copy(g.hasDataDrivenIcon?f:l,c,g.hasDataDrivenText?x:h,d,s);m&&(p.push(m),m.updateSymbols())}}if(this.status===y.TileStatus.INVALID||this.status===y.TileStatus.INITIALIZED||0===l.sizeInBytes&&0===f.sizeInBytes&&0===c.sizeInBytes&&0===h.sizeInBytes&&0===x.sizeInBytes&&0===d.sizeInBytes)return o.reject();var I=[10,l.sizeInBytes,11,f.sizeInBytes,12,c.sizeInBytes,13,h.sizeInBytes,14,x.sizeInBytes,15,d.sizeInBytes],V=new Uint32Array(I),B=[];for(_=0;_<p.length;_++){var b=p[_];B.push(b.layerIndex),B.push(3),B.push(b.sdfMarker?1:0);var D=b.markerPageMap;B.push(D.size),D.forEach((function(e,t){B.push(t),B.push(e[0]),B.push(e[1])}));var w=b.glyphsPageMap;B.push(w.size),w.forEach((function(e,t){B.push(t),B.push(e[0]),B.push(e[1])}))}var P=new Uint32Array(B),T=l.toBuffer(),E=f.toBuffer(),M=c.toBuffer(),z=h.toBuffer(),C=x.toBuffer(),N=d.toBuffer();return o.resolve({result:{bufferDataInfo:V.buffer,bucketDataInfo:P.buffer,bufferData:[T,E,M,z,C,N]},transferList:[T,E,M,z,C,N,V.buffer,P.buffer]})},e.prototype.setObsolete=function(){this.status=y.TileStatus.INVALID},e.prototype.getLayers=function(){return this._workerTileHandler.getLayers()},e.prototype.getWorkerTileHandler=function(){return this._workerTileHandler},e.prototype._parse=function(e,t){return n(this,void 0,void 0,(function(){return r(this,(function(r){return 0===Object.keys(e).length?[2,[]]:(this.status=y.TileStatus.MODIFIED,[2,new d(e,this,t.client).parse(t)])}))}))},e}()}.apply(null,n))||(e.exports=i)},1994:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(21),r(894)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(){return e.call(this,12)||this}return r(t,e),t.prototype.add=function(e,t,r){var n=this.array;n.push(e),n.push(t),n.push(r)},t}(n);t.TriangleIndexBuffer=i;var o=function(e){function t(){return e.call(this,4)||this}return r(t,e),t.prototype.add=function(e){this.array.push(e)},t}(n);t.PointElementMemoryBuffer=o}.apply(null,n))||(e.exports=i)},1998:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(43),r(334),r(346)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t,r,n){this.left=e,this.top=t,this.right=r,this.bottom=n}return e.prototype.clone=function(){return new e(this.left,this.top,this.right,this.bottom)},e.prototype.move=function(e,t){this.left+=e,this.top+=t,this.right+=e,this.bottom+=t},e.prototype.rotate=function(e,t){var r=this.left,n=this.right,i=this.top,o=this.bottom,a=r*e-i*t,s=r*t+i*e,l=n*e-i*t,u=n*t+i*e,f=r*e-o*t,c=r*t+o*e,h=n*e-o*t,x=n*t+o*e;this.left=Math.min(a,l,f,h),this.top=Math.min(s,u,c,x),this.right=Math.max(a,l,f,h),this.bottom=Math.max(s,u,c,x)},e.overlaps=function(e,t){return e.right>t.left&&e.left<t.right&&e.bottom>t.top&&e.top<t.bottom},e}();t.Box=o;var a=function(){function e(e,t,r,n){this.anchor=e,this.corners=t,this.minzoom=r,this.maxzoom=n}return e.prototype.left=function(){return this.corners[0].x},e.prototype.right=function(){return this.corners[2].x},e.prototype.top=function(){return this.corners[1].y},e.prototype.bottom=function(){return this.corners[3].y},e}();t.Obstacle=a;var s=function(){function e(e,t,r){this.obstacles=[],this.mapAngle=e,this.padding=t,this.isScreenAligned=r,this.minzoom=l}return e.prototype.addBox=function(e,t,r,n,o,s,l){var u=t.left*r-this.padding,f=t.top*r-this.padding,c=t.right*r+this.padding,h=t.bottom*r+this.padding,x=[new i.Point(u,f),new i.Point(c,f),new i.Point(c,h),new i.Point(u,h)];if(0!==this.mapAngle){var d=Math.cos(this.mapAngle),p=Math.sin(this.mapAngle);(e=e.clone()).rotate(d,p)}if(this.isScreenAligned||(n+=this.mapAngle),0!==n){d=Math.cos(n),p=Math.sin(n);x[0].rotate(d,p),x[1].rotate(d,p),x[2].rotate(d,p),x[3].rotate(d,p);for(var y=0,_=1;_<4;_++)x[_].x<x[y].x?y=_:x[_].x===x[y].x&&x[_].y<x[y].y&&(y=_);if(y){var v=[];for(_=0;_<4;_++)v.push(x[(_+y)%4]);x=v}}if(o)for(var g=0,m=x;g<m.length;g++){m[g].move(o[0],o[1])}this.obstacles.push(new a(e,x,s,l))},e}();t.Footprint=s;var l=.5,u=function(){function e(){this._grid=[]}return e.prototype.reset=function(){this._grid=[]},e.prototype.add=function(t){for(var r=this._grid,n=0,i=t.obstacles;n<i.length;n++)for(var o=i[n],a=o.anchor,s=e._gridClamp(Math.min(o.left()+a.x,a.x)),l=e._gridClamp(Math.max(o.right()+a.x,a.x)),u=e._gridClamp(Math.min(o.top()+a.y,a.y)),f=e._gridClamp(Math.max(o.bottom()+a.y,a.y)),c=u;c<=f;c++)for(var h=s;h<=l;h++){var x=r[16*c+h];x||(x=r[16*c+h]=[]),x.push(o)}},e.prototype.getMinZoom=function(t,r){if(0===t.obstacles.length)return n.C_INFINITY;for(var i=r,o=this._grid,a=0,s=t.obstacles;a<s.length;a++)for(var l=s[a],u=l.anchor,f=e._gridClamp(Math.min(l.left()+u.x,u.x)),c=e._gridClamp(Math.max(l.right()+u.x,u.x)),h=e._gridClamp(Math.min(l.top()+u.y,u.y)),x=e._gridClamp(Math.max(l.bottom()+u.y,u.y)),d=h;d<=x;d++)for(var p=f;p<=c;p++){var y=o[16*d+p];if(y)for(var _=0,v=y;_<v.length;_++){var g=v[_];if(!(l.minzoom>=g.maxzoom||g.minzoom>=l.maxzoom)&&(i=e._calcPlacementZoom(l,g,i))>=2)return n.C_INFINITY}}return i<2?i:n.C_INFINITY},e._gridClamp=function(e){return r.clamp(e>>9,-7,8)},e._calcPlacementZoom=function(t,r,i){var o=r.anchor.x-t.anchor.x;if(0===o&&(t.right()<r.left()||r.right()<t.left()))return i;var a=r.anchor.y-t.anchor.y;if(0===a&&(t.bottom()<r.top()||r.bottom()<t.top()))return i;var s=n.C_INFINITY;if(0!==o){var l=(o>0?t.right()-r.left():t.left()-r.right())/o;l<s&&(s=l);var u=o>0?e._calcExtZoomX(t,r,l):e._calcExtZoomX(r,t,l);u<s&&(s=u)}if(0!==a){var f=(a>0?t.bottom()-r.top():t.top()-r.bottom())/a;f<s&&(s=f);var c=a>0?e._calcExtZoomY(t,r,f):e._calcExtZoomY(r,t,f);c<s&&(s=c)}return s<t.minzoom||s<r.minzoom?i:((s=Math.min(s,t.maxzoom,r.maxzoom))<i&&(s=i),s)},e._calcExtZoomX=function(e,t,r){var n,i,o,a;if(e.anchor.y+e.corners[2].y/r<t.anchor.y+t.corners[0].y/r){var s=e.corners[2].x-e.corners[3].x,l=e.corners[2].y-e.corners[3].y,u=t.corners[1].x-t.corners[0].x;s*(t.corners[1].y-t.corners[0].y)-l*u>=0?e.anchor.y+e.corners[3].y/r<t.anchor.y+t.corners[0].y/r?(n=e.corners[3],i=t.corners[0],o=t.corners[1],a=1):(n=t.corners[0],i=e.corners[3],o=e.corners[2],a=-1):e.anchor.y+e.corners[2].y/r>t.anchor.y+t.corners[1].y/r?(n=e.corners[2],i=t.corners[0],o=t.corners[1],a=1):(n=t.corners[1],i=e.corners[3],o=e.corners[2],a=-1)}else{s=e.corners[2].x-e.corners[1].x,l=e.corners[2].y-e.corners[1].y,u=t.corners[3].x-t.corners[0].x;s*(t.corners[3].y-t.corners[0].y)-l*u<0?e.anchor.y+e.corners[1].y/r>t.anchor.y+t.corners[0].y/r?(n=e.corners[1],i=t.corners[0],o=t.corners[3],a=1):(n=t.corners[0],i=e.corners[1],o=e.corners[2],a=-1):e.anchor.y+e.corners[2].y/r<t.anchor.y+t.corners[3].y/r?(n=e.corners[2],i=t.corners[0],o=t.corners[3],a=1):(n=t.corners[3],i=e.corners[1],o=e.corners[2],a=-1)}var f=o.x-i.x,c=o.y-i.y;return a*((n.y-i.y)*f-(n.x-i.x)*c)/((e.anchor.x-t.anchor.x)*c-(e.anchor.y-t.anchor.y)*f)},e._calcExtZoomY=function(e,t,r){var n,i,o,a;if(e.anchor.x+e.corners[3].x/r<t.anchor.x+t.corners[1].x/r){var s=e.corners[3].x-e.corners[2].x,l=e.corners[3].y-e.corners[2].y,u=t.corners[0].x-t.corners[1].x;s*(t.corners[0].y-t.corners[1].y)-l*u<0?e.anchor.x+e.corners[2].x/r<t.anchor.x+t.corners[1].x/r?(n=e.corners[2],i=t.corners[1],o=t.corners[0],a=1):(n=t.corners[1],i=e.corners[2],o=e.corners[3],a=-1):e.anchor.x+e.corners[3].x/r>t.anchor.x+t.corners[0].x/r?(n=e.corners[3],i=t.corners[1],o=t.corners[0],a=1):(n=t.corners[0],i=e.corners[2],o=e.corners[3],a=-1)}else{s=e.corners[3].x-e.corners[0].x,l=e.corners[3].y-e.corners[0].y,u=t.corners[2].x-t.corners[1].x;s*(t.corners[2].y-t.corners[1].y)-l*u>0?e.anchor.x+e.corners[0].x/r>t.anchor.x+t.corners[1].x/r?(n=e.corners[0],i=t.corners[1],o=t.corners[2],a=1):(n=t.corners[1],i=e.corners[0],o=e.corners[3],a=-1):e.anchor.x+e.corners[3].x/r<t.anchor.x+t.corners[2].x/r?(n=e.corners[3],i=t.corners[1],o=t.corners[2],a=1):(n=t.corners[2],i=e.corners[0],o=e.corners[3],a=-1)}var f=o.x-i.x,c=o.y-i.y;return a*((n.y-i.y)*f-(n.x-i.x)*c)/((e.anchor.x-t.anchor.x)*c-(e.anchor.y-t.anchor.y)*f)},e}();t.ConflictEngine=u}.apply(null,n))||(e.exports=i)},1999:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(31),r(32),r(291),r(28),r(891),r(892),r(2e3),r(893),r(895),r(2001),r(897),r(109),r(898)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,f,c,h,x,d){return function(){function e(e,t,r){this._pbfTiles={},this._tileClippers={},this._client=r,this._tile=t,this._layers=t.getLayers();var n=t.tileKey.split("/").map(parseFloat),o=n[0],a=n[1],s=n[2];this._level=o;for(var l=Math.max(8,Math.round(1*this._level)-8),u=0,f=Object.keys(e);u<f.length;u++){var c=f[u],h=e[c];if(this._pbfTiles[c]=new i(new Uint8Array(h.protobuff),new DataView(h.protobuff)),h.refKey){var d=o-h.refKey.split("/").map(parseFloat)[0];if(d>0){var p=(1<<d)-1,y=a&p,_=s&p;this._tileClippers[c]=new x.TileClipper(d,y,_,8,l)}}this._tileClippers[c]||(this._tileClippers[c]=new x.SimpleBuilder)}}return e.prototype.parse=function(e){return n(this,void 0,void 0,(function(){var t,n,i,a,s,u,f,c,h,x,p,y,_,v,g,m,I,V,B,b,D,w,P,T,E,M,z,C,N,S,k,A,L,O,F,j,R,G,U,Y,K,Z,H,q,W,J,X,Q,$,ee,te,re,ne,ie,oe,ae,se,le;return r(this,(function(r){for(t=e&&e.signal,n=this._parseTileData(this._pbfTiles),i=this._layers,a=this._level,u=[],f=this._tileClippers,c={},h={},x=i.length-1;x>=0;x--)(s=i[x]).minzoom&&a<s.minzoom||s.maxzoom&&a>=s.maxzoom||s.layout&&s.layout.visibility&&"none"===s.layout.visibility||0!==s.type&&n[s.source]&&f[s.source]&&(N=n[s.source],p=f[s.source],W=s.sourceLayer,(S=N[W])&&((y=h[s.source])||(y=h[s.source]=new Set),y.add(s.sourceLayer),(te=this._createBucket(s))&&(te.layerIndex=x,te.layerExtent=S.extent,te.tileClipper=p,(k=c[s.source])||(k=c[s.source]={}),(_=k[W])||(_=k[W]=[]),_.push(te))));for(v=10*this._level,g=10*(this._level+1),m=[],I=[],V=[],B=[],b=new Set,D={},w=[],P=[],T=function(e){h[e].forEach((function(t){w.push(t),P.push(e)}))},E=0,M=Object.keys(h);E<M.length;E++)H=M[E],T(H);for(z=0;z<w.length&&(H=P[z],C=w[z],n[H]&&c[H])&&(N=n[H],S=N[C],k=c[H],(J=k[C])&&0!==J.length);z++){if(o.isAborted(t))return[2,void 0];for(A=S.getData();A.next(2);){if(L=A.getMessage(),O=new l(L,S),L.release(),F=O.values){if((j=F._minzoom)&&j>=g)continue;if((R=F._maxzoom)&&R<=v)continue}for(G=0,U=J;G<U.length;G++)(te=U[G]).pushFeature(O)}}for(Y=this._tile,K=0,Z=Object.keys(c);K<Z.length;K++)for(W in H=Z[K],q=c[H])for(J=q[W],X=0,Q=J;X<Q.length;X++)(te=Q[X]).hasFeatures()&&(3===te.layer.type?(m.push(te),Y.addBucket(te)):te.layer.refLayerId?V.push(te):(I.push(te),B[te.layer.id]=te));for($=0,ee=m;$<ee.length;$++)te=ee[$],(re=te).getResources(re.tileClipper,b,D);if(this._tile.status===d.TileStatus.INVALID)return[2,o.resolve([])];for(se in ne=[],ie=this._tile.getWorkerTileHandler(),b.size>0&&(oe=ie.fetchSprites(b,this._client,e),ne.push(oe)),D)(le=D[se]).size>0&&(ae=ie.fetchGlyphs(this._tile.tileKey,se,le,this._client,e),ne.push(ae));return[2,o.all(ne).then((function(){for(var e=0,t=I;e<t.length;e++){var r=t[e];r.processFeatures(r.tileClipper),u.push(r)}for(var n=0,i=V;n<i.length;n++){var o=i[n],a=B[o.layer.refLayerId];a&&(a.assignBufferInfo(o),u.push(o))}for(var s=0,l=m;s<l.length;s++){var f=l[s];f.processFeatures(f.tileClipper),u.push(f)}return u.sort((function(e,t){return e.layerIndex-t.layerIndex})),u}))]}))}))},e.prototype._parseTileData=function(e){for(var t={},r=0,n=Object.keys(e);r<n.length;r++){for(var i=n[r],o=e[i],a={};o.next();)switch(o.tag()){case 3:var s=o.getMessage(),l=new c(s);s.release(),a[l.name]=l;break;default:o.skip()}t[i]=a}return t},e.prototype._createBucket=function(e){switch(e.type){case 0:return this._createBackgroundBucket(e);case 1:return this._createFillBucket(e);case 2:return this._createLineBucket(e);case 4:return this._createCircleBucket(e);case 3:return this._createSymbolBucket(e)}},e.prototype._createBackgroundBucket=function(e){return new a(e,this._level)},e.prototype._createFillBucket=function(e){var t=this._tile;return new u(e,this._level,e.hasDataDrivenFill?t.fillDDVertexBuffer:t.fillVertexBuffer,t.fillIndexBuffer,e.hasDataDrivenOutline?t.outlineDDVertexBuffer:t.outlineVertexBuffer,t.outlineIndexBuffer)},e.prototype._createLineBucket=function(e){var t=this._tile;return new f(e,this._level,e.hasDataDrivenLine?t.lineDDVertexBuffer:t.lineVertexBuffer,t.lineIndexBuffer)},e.prototype._createCircleBucket=function(e){var t=this._tile;return new s(e,this._level,t.circleVertexBuffer,t.circleIndexBuffer)},e.prototype._createSymbolBucket=function(e){var t=this._tile;return new h(e,this._level,e.hasDataDrivenIcon?t.iconDDVertexBuffer:t.iconVertexBuffer,t.iconIndexBuffer,e.hasDataDrivenText?t.textDDVertexBuffer:t.textVertexBuffer,t.textIndexBuffer,t.placementEngine,t.getWorkerTileHandler())},e}()}.apply(null,n))||(e.exports=i)},2e3:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(346)],void 0===(i=function(e,t,r){return function(){function e(e,t){this.values={};for(var r=t.keys,n=t.values;e.next();)switch(e.tag()){case 1:this.id=e.getUInt64();break;case 2:for(var i=e.getMessage(),o=this.values;!i.empty();){var a=i.getUInt32(),s=i.getUInt32();o[r[a]]=n[s]}i.release();break;case 3:this.type=e.getUInt32();break;case 4:this._pbfGeometry=e.getMessage();break;default:e.skip()}}return e.prototype.getGeometry=function(e){if(void 0!==this._geometry)return this._geometry;if(!this._pbfGeometry)return null;var t,n,i,o=this._pbfGeometry;this._pbfGeometry=null,e?e.reset(this.type):t=[];for(var a=1,s=0,l=0,u=0;!o.empty();){if(0===s){var f=o.getUInt32();a=7&f,s=f>>3}switch(s--,a){case 1:l+=o.getSInt32(),u+=o.getSInt32(),e?e.moveTo(l,u):(n&&t.push(n),(n=[]).push(new r.Point(l,u)));break;case 2:l+=o.getSInt32(),u+=o.getSInt32(),e?e.lineTo(l,u):n.push(new r.Point(l,u));break;case 7:e?e.close():n&&!n[0].equals(l,u)&&n.push(n[0].clone());break;default:throw o.release(),new Error("Invalid path operation")}}return e?i=e.result():(n&&t.push(n),i=t),o.release(),this._geometry=i,i},e}()}.apply(null,n))||(e.exports=i)},2001:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){return function(){function e(t){for(this.extent=4096,this.keys=[],this.values=[],this._pbfLayer=t.clone();t.next();)switch(t.tag()){case 1:this.name=t.getString();break;case 3:this.keys.push(t.getString());break;case 4:this.values.push(t.processMessage(e._parseValue));break;case 5:this.extent=t.getUInt32();break;default:t.skip()}}return e.prototype.getData=function(){return this._pbfLayer},e._parseValue=function(e){for(;e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getInt64();case 5:return e.getUInt64();case 6:return e.getSInt64();case 7:return e.getBool();default:e.skip()}return null},e}()}.apply(null,n))||(e.exports=i)},2002:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(21),r(334),r(894)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=new Float32Array(1),a=new Uint32Array(o.buffer),s=function(e){function t(t){var r=e.call(this,t?20:12)||this;return r._isDataDriven=t,r}return r(t,e),t.prototype.isDataDriven=function(){return this._isDataDriven},t.prototype.add=function(e,t,r,n,s,l,u,f){var c=this.array,h=i.i1616to32(e,t);if(c.push(h),h=i.i8888to32(Math.round(31*r),Math.round(31*n),Math.round(31*s),Math.round(31*l)),c.push(h),h=i.i1616to32(u,0),c.push(h),this._isDataDriven){if(!f)throw new Error("Expecting data driven values.");var x=f.color,d=x[3]*f.opacity*255;c.push(i.i8888to32(x[0]*d,x[1]*d,x[2]*d,d)),o[0]=f.size,c.push(a[0])}},t}(i);t.LineVertexBuffer=s;var l=function(e){function t(t){var r=e.call(this,t?8:4)||this;return r._isDataDriven=t,r}return r(t,e),t.prototype.isDataDriven=function(){return this._isDataDriven},t.prototype.add=function(e,t,r){var n=this.array;if(n.push(i.i1616to32(e,t)),this._isDataDriven){if(!r)throw new Error("Expecting data driven values.");var o=r.color,a=o[3]*r.opacity*255;n.push(i.i8888to32(o[0]*a,o[1]*a,o[2]*a,a))}},t}(i);t.FillVertexBuffer=l;var u=function(e){function t(t){var r=e.call(this,t?12:8)||this;return r._isDataDriven=t,r}return r(t,e),t.prototype.isDataDriven=function(){return this._isDataDriven},t.prototype.add=function(e,t,r,n,o,a,s){var l=this.array,u=this.index,f=i.i1616to32(e,t);if(l.push(f),f=i.i8888to32(Math.round(15*r),Math.round(15*n),o,a),l.push(f),this._isDataDriven){if(!s)throw new Error("Expecting data driven values.");var c=s.color,h=c[3]*s.opacity*255;l.push(i.i8888to32(c[0]*h,c[1]*h,c[2]*h,h))}return u},t}(i);t.OutlineVertexBuffer=u;var f=function(e){function t(t){var r=e.call(this,t?24:16)||this;return r._isDataDriven=t,r}return r(t,e),t.prototype.isDataDriven=function(){return this._isDataDriven},t.prototype.add=function(e,t,r,s,l,u,f,c,h,x,d){var p=this.array,y=i.i1616to32(e,t);if(p.push(y),y=i.i1616to32(Math.round(8*r),Math.round(8*s)),p.push(y),y=i.i8888to32(l/4,u/4,0,0),p.push(y),y=i.i8888to32(Math.ceil(10*x),n.radToByte(f),10*c,Math.min(10*h,255)),p.push(y),this._isDataDriven){if(!d)throw new Error("Expecting data driven values.");var _=d.color,v=_[3]*d.opacity*255;p.push(i.i8888to32(_[0]*v,_[1]*v,_[2]*v,v)),o[0]=d.size,p.push(a[0])}},t}(i);t.SymbolVertexBuffer=f;var c=function(e){function t(){return e.call(this,16)||this}return r(t,e),t.prototype.add=function(e,t,r,n,o,a,s,l,u,f,c){var h=this.array,x=i.i1616to32(2*e+r,2*t+n);h.push(x);var d=a[3]*s*255;x=i.i8888to32(a[0]*d,a[1]*d,a[2]*d,d),h.push(x);var p=f[3]*c*255;x=i.i8888to32(f[0]*p,f[1]*p,f[2]*p,p),h.push(x),x=i.i8888to32(Math.min(32*l,255),Math.min(4*u,255),Math.min(o,255),0),h.push(x)},t}(i);t.CircleVertexBuffer=c}.apply(null,n))||(e.exports=i)},565:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){return function(){function e(e,t){this.layerExtent=4096,this._features=[],this.layer=e,this.zoom=t,this._filter=e.getFeatureFilter()}return e.prototype.pushFeature=function(e){this._filter.filter(e)&&this._features.push(e)},e.prototype.hasFeatures=function(){return this._features.length>0},e}()}.apply(null,n))||(e.exports=i)},891:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(21),r(565)],void 0===(i=function(e,t,r,n){return function(e){function t(t,r){return e.call(this,t,r)||this}return r(t,e),t.prototype.processFeatures=function(){},t.prototype.assignBufferInfo=function(){},t}(n)}.apply(null,n))||(e.exports=i)},892:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(21),r(565)],void 0===(i=function(e,t,r,n){return function(e){function t(t,r,n,i){var o=e.call(this,t,r)||this;return o._circleVertexBuffer=n,o._circleIndexBuffer=i,o}return r(t,e),Object.defineProperty(t.prototype,"circleIndexStart",{get:function(){return this._circleIndexStart},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"circleIndexCount",{get:function(){return this._circleIndexCount},enumerable:!0,configurable:!0}),t.prototype.assignBufferInfo=function(e){var t=e;t._circleIndexStart=this._circleIndexStart,t._circleIndexCount=this._circleIndexCount},t.prototype.processFeatures=function(e){var t=this._circleVertexBuffer,r=this._circleIndexBuffer;this._circleIndexStart=r.index,this._circleIndexCount=0;var n=this.layer,i=this.zoom;e&&e.setExtent(this.layerExtent);for(var o=1,a=[1,1,1,1],s=1,l=0,u=1,f=[1,1,1,1],c=1,h=0,x=this._features;h<x.length;h++){var d=x[h],p=d.getGeometry(e);if(p){n.hasDataDrivenRadius&&(o=n.getPaintValue("circle-radius",i,d)),n.hasDataDrivenColor&&(a=n.getPaintValue("circle-color",i,d)),n.hasDataDrivenOpacity&&(s=n.getPaintValue("circle-opacity",i,d)),n.hasDataDrivenStrokeWidth&&(u=n.getPaintValue("circle-stroke-width",i,d)),n.hasDataDrivenStrokeColor&&(f=n.getPaintValue("circle-stroke-color",i,d)),n.hasDataDrivenStrokeOpacity&&(c=n.getPaintValue("circle-stroke-opacity",i,d)),n.hasDataDrivenBlur&&(l=n.getPaintValue("circle-blur",i,d));for(var y=0,_=p;y<_.length;y++){var v=_[y];if(v)for(var g=0,m=v;g<m.length;g++){var I=m[g],V=t.index;t.add(I.x,I.y,0,0,o,a,s,l,u,f,c),t.add(I.x,I.y,0,1,o,a,s,l,u,f,c),t.add(I.x,I.y,1,0,o,a,s,l,u,f,c),t.add(I.x,I.y,1,1,o,a,s,l,u,f,c),r.add(V+0,V+1,V+2),r.add(V+1,V+2,V+3),this._circleIndexCount+=6}}}}},t}(n)}.apply(null,n))||(e.exports=i)},893:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(21),r(425),r(189),r(565),r(346)],void 0===(i=function(e,t,r,n,i,o,a){return function(e){function t(t,r,n,i,o,a){var s=e.call(this,t,r)||this;if(t.hasDataDrivenFill!==n.isDataDriven())throw new Error("incompatible fill buffer");if(t.hasDataDrivenOutline!==o.isDataDriven())throw new Error("incompatible outline buffer");return s._fillVertexBuffer=n,s._fillIndexBuffer=i,s._outlineVertexBuffer=o,s._outlineIndexBuffer=a,s}return r(t,e),Object.defineProperty(t.prototype,"fillIndexStart",{get:function(){return this._fillIndexStart},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fillIndexCount",{get:function(){return this._fillIndexCount},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"outlineIndexStart",{get:function(){return this._outlineIndexStart},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"outlineIndexCount",{get:function(){return this._outlineIndexCount},enumerable:!0,configurable:!0}),t.prototype.assignBufferInfo=function(e){var t=e;t._fillIndexStart=this._fillIndexStart,t._fillIndexCount=this._fillIndexCount,e.layer.getPaintProperty("fill-outline-color")?(t._outlineIndexStart=this._outlineIndexStart,t._outlineIndexCount=this._outlineIndexCount):(t._outlineIndexStart=0,t._outlineIndexCount=0)},t.prototype.processFeatures=function(e){this._fillIndexStart=this._fillIndexBuffer.index,this._fillIndexCount=0,this._outlineIndexStart=this._outlineIndexBuffer.index,this._outlineIndexCount=0;var t=this.layer,r=this.zoom,n=t.hasDataDrivenFill,i=t.hasDataDrivenOutline;e&&e.setExtent(this.layerExtent);var o=t.getPaintValue("fill-pattern",r),a=t.getPaintValue("fill-antialias",r)&&void 0===o,s=[1,1,1,1],l=[1,1,1,1],u=1;if(t.outlineUsesFillColor){if(a&&!t.hasDataDrivenOpacity){var f=t.getPaintValue("fill-opacity",r),c=t.getPaintValue("fill-opacity",r+1);f<1&&c<1&&(a=!1)}if(a&&!t.hasDataDrivenColor){var h=t.getPaintValue("fill-color",r),x=t.getPaintValue("fill-color",r+1);h[3]<1&&x[3]<1&&(a=!1)}}for(var d=0,p=this._features;d<p.length;d++){var y=p[d];!o&&t.hasDataDrivenColor&&(s=t.getPaintValue("fill-color",r,y)),t.hasDataDrivenOpacity&&(u=t.getPaintValue("fill-opacity",r,y)),!o&&t.hasDataDrivenOutlineColor&&(l=t.getPaintValue("fill-outline-color",r,y));var _=void 0;n&&(_={color:s,opacity:u});var v=void 0;i&&(v={color:t.outlineUsesFillColor?s:l,opacity:u});var g=y.getGeometry(e);this._processFeature(g,a,t.outlineUsesFillColor,_,v)}},t.prototype._processFeature=function(e,r,n,i,o){if(e){var a=e.length;if(r&&(!n||!o||o.color[3]*o.opacity==1))for(var s=0;s<a;s++)this._processOutline(e[s],o);var l;for(s=0;s<a;s++){var u=t._area(e[s]);u>128?(void 0!==l&&this._processFill(e,l,i),l=[s]):u<-128&&void 0!==l&&l.push(s)}void 0!==l&&this._processFill(e,l,i)}},t.prototype._processOutline=function(e,t){var r,n,i,o=this._outlineVertexBuffer,s=this._outlineIndexBuffer,l=s.index,u=new a.Point(0,0),f=new a.Point(0,0),c=new a.Point(0,0),h=-1,x=-1,d=-1,p=-1,y=-1,_=!1,v=e.length;if(!(v<2)){for(var g=e[0],m=e[v-1];v&&m.isEqual(g);)m=e[--v-1];if(!(v-0<2)){for(var I=0;I<v;++I){0===I?(r=e[v-1],n=e[0],i=e[1],u.assignSub(n,r),u.normalize(),u.rightPerpendicular()):(r=n,n=i,i=I!==v-1?e[I+1]:e[0],u.assign(f));var V=this._isClipEdge(r,n);-1===p&&(_=V),f.assignSub(i,n),f.normalize(),f.rightPerpendicular();var B=u.x*f.y-u.y*f.x;c.assignAdd(u,f),c.normalize();var b=-c.x*-u.x+-c.y*-u.y,D=Math.abs(0!==b?1/b:1);D>8&&(D=8),B>=0?(d=o.add(n.x,n.y,u.x,u.y,0,1,t),-1===p&&(p=d),h>=0&&x>=0&&d>=0&&!V&&s.add(h,x,d),x=o.add(n.x,n.y,D*-c.x,D*-c.y,0,-1,t),-1===y&&(y=x),h>=0&&x>=0&&d>=0&&!V&&s.add(h,x,d),h=x,x=d,d=o.add(n.x,n.y,c.x,c.y,0,1,t),h>=0&&x>=0&&d>=0&&!V&&s.add(h,x,d),x=o.add(n.x,n.y,f.x,f.y,0,1,t),h>=0&&x>=0&&d>=0&&!V&&s.add(h,x,d)):(d=o.add(n.x,n.y,D*c.x,D*c.y,0,1,t),-1===p&&(p=d),h>=0&&x>=0&&d>=0&&!V&&s.add(h,x,d),x=o.add(n.x,n.y,-u.x,-u.y,0,-1,t),-1===y&&(y=x),h>=0&&x>=0&&d>=0&&!V&&s.add(h,x,d),h=x,x=d,d=o.add(n.x,n.y,-c.x,-c.y,0,-1,t),h>=0&&x>=0&&d>=0&&!V&&s.add(h,x,d),(h=o.add(n.x,n.y,-f.x,-f.y,0,-1,t))>=0&&x>=0&&d>=0&&!V&&s.add(h,x,d))}h>=0&&x>=0&&p>=0&&!_&&s.add(h,x,p),h>=0&&p>=0&&y>=0&&!_&&s.add(h,y,p),this._outlineIndexCount+=3*(s.index-l)}}},t.prototype._processFill=function(e,t,r){var o;t.length>1&&(o=[]);for(var a=0,s=0,l=t;s<l.length;s++){var u=l[s];0!==a&&o.push(a),a+=e[u].length}for(var f=2*a,c=n.acquire(),h=0,x=t;h<x.length;h++)for(var d=e[u=x[h]],p=d.length,y=0;y<p;++y)c.push(d[y].x),c.push(d[y].y);var _=i(c,o,2),v=_.length;if(v>0){for(var g=this._fillVertexBuffer.index,m=0;m<f;)this._fillVertexBuffer.add(c[m++],c[m++],r);for(var I=0;I<v;)this._fillIndexBuffer.add(g+_[I++],g+_[I++],g+_[I++]);this._fillIndexCount+=v}n.release(c)},t.prototype._isClipEdge=function(e,t){return e.x===t.x?e.x<=-64||e.x>=4160:e.y===t.y&&(e.y<=-64||e.y>=4160)},t._area=function(e){for(var t=0,r=e.length-1,n=0;n<r;n++)t+=(e[n].x-e[n+1].x)*(e[n].y+e[n+1].y);return.5*(t+(e[r].x-e[0].x)*(e[r].y+e[0].y))},t}(o)}.apply(null,n))||(e.exports=i)},894:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){return function(){function e(e){this._array=[],e<=0&&console.error("strideInBytes must be positive!"),this._stride=e}return Object.defineProperty(e.prototype,"array",{get:function(){return this._array},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"index",{get:function(){return 4*this._array.length/this._stride},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"itemSize",{get:function(){return this._stride},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sizeInBytes",{get:function(){return 4*this._array.length},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.array.length=0},e.prototype.toBuffer=function(){return new Uint32Array(this._array).buffer},e.i1616to32=function(e,t){return 65535&e|t<<16},e.i8888to32=function(e,t,r,n){return 255&e|(255&t)<<8|(255&r)<<16|n<<24},e.i8816to32=function(e,t,r){return 255&e|(255&t)<<8|r<<16},e}()}.apply(null,n))||(e.exports=i)},895:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(21),r(36),r(63),r(565),r(716),r(192),r(56)],void 0===(i=function(e,t,r,n,i,o,a,s,l){var u=0,f=0,c=0;n("esri-tiles-performance")&&setInterval((function(){console.log("New (VTL)","feat="+c,"secs="+u,"tris="+f,"tris/sec="+Math.round(f/u))}),1e4);var h=function(e){return function(t){t.entry0=e._lineVertexBuffer.index,e._lineVertexBuffer.add(t.currentVertex.x,t.currentVertex.y,t.prevNormal.x,t.prevNormal.y,0,-1,t.distance,e._ddValues),t.entry2=e._lineVertexBuffer.index,e._lineVertexBuffer.add(t.currentVertex.x,t.currentVertex.y,-t.prevNormal.x,-t.prevNormal.y,0,1,t.distance,e._ddValues),t.exit0=e._lineVertexBuffer.index,e._lineVertexBuffer.add(t.currentVertex.x,t.currentVertex.y,t.nextNormal.x,t.nextNormal.y,0,-1,t.distance,e._ddValues),t.exit2=e._lineVertexBuffer.index,e._lineVertexBuffer.add(t.currentVertex.x,t.currentVertex.y,-t.nextNormal.x,-t.nextNormal.y,0,1,t.distance,e._ddValues)}},x=function(e){return function(t){e._lineIndexBuffer.add(t.leftExit0,t.rightEntry0,t.leftExit2),e._lineIndexBuffer.add(t.rightEntry0,t.rightEntry2,t.leftExit2)}},d=function(e){return function(t){var r,n=e._joinType===i.JoinType.MITER?e._miterLimitCosine:e._roundLimitCosine,o=t.isCap&&e._capType!==i.CapType.BUTT,a=!1;if(t.cosine>.97?(t.exit0=t.entry0=e._lineVertexBuffer.index,e._lineVertexBuffer.add(t.currentVertex.x,t.currentVertex.y,t.bisector.x/t.cosine,t.bisector.y/t.cosine,0,-1,t.distance,e._ddValues),t.exit2=t.entry2=e._lineVertexBuffer.index,e._lineVertexBuffer.add(t.currentVertex.x,t.currentVertex.y,-t.bisector.x/t.cosine,-t.bisector.y/t.cosine,0,1,t.distance,e._ddValues)):t.cosine<1-.97?(t.entry0=e._lineVertexBuffer.index,e._lineVertexBuffer.add(t.currentVertex.x,t.currentVertex.y,t.prevNormal.x,t.prevNormal.y,0,-1,t.distance,e._ddValues),t.entry2=e._lineVertexBuffer.index,e._lineVertexBuffer.add(t.currentVertex.x,t.currentVertex.y,-t.prevNormal.x,-t.prevNormal.y,0,1,t.distance,e._ddValues),t.exit0=e._lineVertexBuffer.index,e._lineVertexBuffer.add(t.currentVertex.x,t.currentVertex.y,t.nextNormal.x,t.nextNormal.y,0,-1,t.distance,e._ddValues),t.exit2=e._lineVertexBuffer.index,e._lineVertexBuffer.add(t.currentVertex.x,t.currentVertex.y,-t.nextNormal.x,-t.nextNormal.y,0,1,t.distance,e._ddValues)):t.canSplit?(s.splitVertex(),t.sign>0?(t.splitInner?(t.exit0=e._lineVertexBuffer.index,e._lineVertexBuffer.add(t.currentVertex.x,t.currentVertex.y,t.leftInner.x,t.leftInner.y,0,-1,t.distance,e._ddValues),t.entry0=e._lineVertexBuffer.index,e._lineVertexBuffer.add(t.currentVertex.x,t.currentVertex.y,t.rightInner.x,t.rightInner.y,0,-1,t.distance,e._ddValues)):(t.exit0=t.entry0=e._lineVertexBuffer.index,e._lineVertexBuffer.add(t.currentVertex.x,t.currentVertex.y,t.bisector.x/t.cosine,t.bisector.y/t.cosine,0,-1,t.distance,e._ddValues)),t.cosine<n?(a=!t.isCap,t.entry2=e._lineVertexBuffer.index,e._lineVertexBuffer.add(t.currentVertex.x,t.currentVertex.y,-t.prevNormal.x,-t.prevNormal.y,0,1,t.distance,e._ddValues),t.exit2=e._lineVertexBuffer.index,e._lineVertexBuffer.add(t.currentVertex.x,t.currentVertex.y,-t.nextNormal.x,-t.nextNormal.y,0,1,t.distance,e._ddValues)):t.splitOuter?(a=a||t.gapOuter,t.entry2=e._lineVertexBuffer.index,e._lineVertexBuffer.add(t.currentVertex.x,t.currentVertex.y,-t.leftOuter.x,-t.leftOuter.y,0,1,t.distance,e._ddValues),t.exit2=e._lineVertexBuffer.index,e._lineVertexBuffer.add(t.currentVertex.x,t.currentVertex.y,-t.rightOuter.x,-t.rightOuter.y,0,1,t.distance,e._ddValues)):(t.entry2=t.exit2=e._lineVertexBuffer.index,e._lineVertexBuffer.add(t.currentVertex.x,t.currentVertex.y,-t.bisector.x/t.cosine,-t.bisector.y/t.cosine,0,1,t.distance,e._ddValues))):(t.splitInner?(t.exit2=e._lineVertexBuffer.index,e._lineVertexBuffer.add(t.currentVertex.x,t.currentVertex.y,-t.leftInner.x,-t.leftInner.y,0,1,t.distance,e._ddValues),t.entry2=e._lineVertexBuffer.index,e._lineVertexBuffer.add(t.currentVertex.x,t.currentVertex.y,-t.rightInner.x,-t.rightInner.y,0,1,t.distance,e._ddValues)):(t.exit2=t.entry2=e._lineVertexBuffer.index,e._lineVertexBuffer.add(t.currentVertex.x,t.currentVertex.y,-t.bisector.x/t.cosine,-t.bisector.y/t.cosine,0,1,t.distance,e._ddValues)),t.cosine<n?(a=!t.isCap,t.entry0=e._lineVertexBuffer.index,e._lineVertexBuffer.add(t.currentVertex.x,t.currentVertex.y,t.prevNormal.x,t.prevNormal.y,0,-1,t.distance,e._ddValues),t.exit0=e._lineVertexBuffer.index,e._lineVertexBuffer.add(t.currentVertex.x,t.currentVertex.y,t.nextNormal.x,t.nextNormal.y,0,-1,t.distance,e._ddValues)):t.splitOuter?(a=a||t.gapOuter,t.entry0=e._lineVertexBuffer.index,e._lineVertexBuffer.add(t.currentVertex.x,t.currentVertex.y,t.leftOuter.x,t.leftOuter.y,0,-1,t.distance,e._ddValues),t.exit0=e._lineVertexBuffer.index,e._lineVertexBuffer.add(t.currentVertex.x,t.currentVertex.y,t.rightOuter.x,t.rightOuter.y,0,-1,t.distance,e._ddValues)):(t.exit0=t.entry0=e._lineVertexBuffer.index,e._lineVertexBuffer.add(t.currentVertex.x,t.currentVertex.y,t.bisector.x/t.cosine,t.bisector.y/t.cosine,0,-1,t.distance,e._ddValues)))):t.sign>0?(t.exit0=t.entry0=e._lineVertexBuffer.index,e._lineVertexBuffer.add(t.currentVertex.x,t.currentVertex.y,t.bisector.x/t.cosine,t.bisector.y/t.cosine,0,-1,t.distance,e._ddValues),t.cosine<n?(a=!t.isCap,t.entry2=e._lineVertexBuffer.index,e._lineVertexBuffer.add(t.currentVertex.x,t.currentVertex.y,-t.prevNormal.x,-t.prevNormal.y,0,1,t.distance,e._ddValues),t.exit2=e._lineVertexBuffer.index,e._lineVertexBuffer.add(t.currentVertex.x,t.currentVertex.y,-t.nextNormal.x,-t.nextNormal.y,0,1,t.distance,e._ddValues)):(t.entry2=t.exit2=e._lineVertexBuffer.index,e._lineVertexBuffer.add(t.currentVertex.x,t.currentVertex.y,-t.bisector.x/t.cosine,-t.bisector.y/t.cosine,0,1,t.distance,e._ddValues))):(t.exit2=t.entry2=e._lineVertexBuffer.index,e._lineVertexBuffer.add(t.currentVertex.x,t.currentVertex.y,-t.bisector.x/t.cosine,-t.bisector.y/t.cosine,0,1,t.distance,e._ddValues),t.cosine<n?(a=!t.isCap,t.entry0=e._lineVertexBuffer.index,e._lineVertexBuffer.add(t.currentVertex.x,t.currentVertex.y,t.prevNormal.x,t.prevNormal.y,0,-1,t.distance,e._ddValues),t.exit0=e._lineVertexBuffer.index,e._lineVertexBuffer.add(t.currentVertex.x,t.currentVertex.y,t.nextNormal.x,t.nextNormal.y,0,-1,t.distance,e._ddValues)):(t.exit0=t.entry0=e._lineVertexBuffer.index,e._lineVertexBuffer.add(t.currentVertex.x,t.currentVertex.y,t.bisector.x/t.cosine,t.bisector.y/t.cosine,0,-1,t.distance,e._ddValues))),t.canSplit&&(t.splitInner||t.splitOuter)||a||o?(r=t.entry1=t.exit1=e._lineVertexBuffer.index,e._lineVertexBuffer.add(t.currentVertex.x,t.currentVertex.y,0,0,0,0,t.distance,e._ddValues)):r=t.entry1=t.exit1=null,a&&e._joinType!==i.JoinType.ROUND)e._lineIndexBuffer.add(r,t.sign>0?t.exit2:t.entry0,t.sign>0?t.entry2:t.exit0);else if(o&&e._capType===i.CapType.ROUND||a&&e._joinType===i.JoinType.ROUND){var l,u=void 0,f=void 0,c=void 0,h=void 0,x=void 0,d=void 0;if(t.isCap)d=(l=Math.PI)/(x=Math.ceil(l/.8)),t.isFirstVertex?(u=t.prevNormal.x,f=t.prevNormal.y,c=t.entry0,h=t.entry2):t.isLastVertex&&(u=-t.nextNormal.x,f=-t.nextNormal.y,c=t.exit2,h=t.exit0);else d=(l=2*Math.acos(t.cosine))/(x=Math.ceil(l/.8)),u=t.sign>0?-t.prevNormal.x:t.nextNormal.x,f=t.sign>0?-t.prevNormal.y:t.nextNormal.y,c=t.sign>0?t.entry2:t.exit0,h=t.sign>0?t.exit2:t.entry0;var p=Math.cos(d),y=Math.sin(d),_=y*u+p*f;u=p*u-y*f,f=_;for(var v=void 0,g=void 0,m=0;m<x;++m){if(v=g,m<x-1)if(t.isCap){var I=t.isFirstVertex?-1:1;g=e._lineVertexBuffer.index,e._lineVertexBuffer.add(t.currentVertex.x,t.currentVertex.y,u,f,I,0,t.distance,e._ddValues)}else g=e._lineVertexBuffer.index,e._lineVertexBuffer.add(t.currentVertex.x,t.currentVertex.y,u,f,0,t.sign,t.distance,e._ddValues);e._lineIndexBuffer.add(0===m?c:v,r,m===x-1?h:g);var V=y*u+p*f;u=p*u-y*f,f=V}}else if(o&&e._capType===i.CapType.SQUARE){var B=t.isFirstVertex?1:-1,b=void 0,D=void 0;e._hasPattern?(b=e._lineVertexBuffer.index,e._lineVertexBuffer.add(t.currentVertex.x,t.currentVertex.y,t.prevNormal.x-B*t.inbound.x,t.prevNormal.y-B*t.inbound.y,-B,-1,t.distance,e._ddValues),D=e._lineVertexBuffer.index,e._lineVertexBuffer.add(t.currentVertex.x,t.currentVertex.y,-t.prevNormal.x-B*t.inbound.x,-t.prevNormal.y-B*t.inbound.y,-B,1,t.distance,e._ddValues)):(b=e._lineVertexBuffer.index,e._lineVertexBuffer.add(t.currentVertex.x,t.currentVertex.y,t.prevNormal.x-B*t.inbound.x,t.prevNormal.y-B*t.inbound.y,0,-1,t.distance,e._ddValues),D=e._lineVertexBuffer.index,e._lineVertexBuffer.add(t.currentVertex.x,t.currentVertex.y,-t.prevNormal.x-B*t.inbound.x,-t.prevNormal.y-B*t.inbound.y,0,1,t.distance,e._ddValues)),B>0?(e._lineIndexBuffer.add(r,t.entry2,D),e._lineIndexBuffer.add(r,D,b),e._lineIndexBuffer.add(r,b,t.entry0)):(e._lineIndexBuffer.add(r,D,t.exit2),e._lineIndexBuffer.add(r,b,D),e._lineIndexBuffer.add(r,t.exit0,b))}}},p=function(e){return function(t){e._lineIndexBuffer.add(t.leftExit0,t.rightEntry0,null!=t.leftExit1?t.leftExit1:t.leftExit2),e._lineIndexBuffer.add(t.rightEntry0,null!=t.rightEntry1?t.rightEntry1:t.rightEntry2,null!=t.leftExit1?t.leftExit1:t.leftExit2),null!=t.leftExit1&&null!=t.rightEntry1?(e._lineIndexBuffer.add(t.leftExit1,t.rightEntry1,t.leftExit2),e._lineIndexBuffer.add(t.rightEntry1,t.rightEntry2,t.leftExit2)):null!=t.leftExit1?e._lineIndexBuffer.add(t.leftExit1,t.rightEntry2,t.leftExit2):null!=t.rightEntry1&&e._lineIndexBuffer.add(t.rightEntry1,t.rightEntry2,t.leftExit2)}};return function(e){function t(t,r,n,i){var o=e.call(this,t,r)||this;if(o._tessellationOptions={},o.tessellationProperties={_lineVertexBuffer:null,_lineIndexBuffer:null,_hasPattern:null,_ddValues:null,_capType:null,_joinType:null,_miterLimitCosine:null,_roundLimitCosine:null},t.hasDataDrivenLine!==n.isDataDriven())throw new Error("incompatible line buffer");return o.tessellationProperties._lineVertexBuffer=n,o.tessellationProperties._lineIndexBuffer=i,o.tessellationProperties._hasPattern=t.getPaintValue("line-pattern",o.zoom)||t.getPaintValue("line-dasharray",o.zoom).length>0,o._isThinLine=t.isThinLine,o._isThinLine?o._tessellationCallbacks={vertex:h(o.tessellationProperties),bridge:x(o.tessellationProperties)}:o._tessellationCallbacks={vertex:d(o.tessellationProperties),bridge:p(o.tessellationProperties)},o}return r(t,e),Object.defineProperty(t.prototype,"lineIndexStart",{get:function(){return this._lineIndexStart},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lineIndexCount",{get:function(){return this._lineIndexCount},enumerable:!0,configurable:!0}),t.prototype.assignBufferInfo=function(e){var t=e;t._lineIndexStart=this._lineIndexStart,t._lineIndexCount=this._lineIndexCount},t.prototype.processFeatures=function(e){this._lineIndexStart=this.tessellationProperties._lineIndexBuffer.index,this._lineIndexCount=0;var t=this.layer,r=this.zoom,n=t.hasDataDrivenLine;e&&e.setExtent(this.layerExtent);for(var i=[1,1,1,1],o=1,u=1,f=0,c=this._features;f<c.length;f++){var h=c[f],x=new a.LineLayout(t,r,h);!this.tessellationProperties._hasPattern&&t.hasDataDrivenColor&&(i=t.getPaintValue("line-color",r,h)),t.hasDataDrivenOpacity&&(o=t.getPaintValue("line-opacity",r,h)),t.hasDataDrivenWidth&&(u=t.getPaintValue("line-width",r,h));var d=void 0;if(!(n&&(d={color:i,opacity:o,size:Math.max(Math.min(u,256),0)},d.size<=0||d.opacity<=0||d.color[3]<=0))){this.tessellationProperties._capType=x.cap,this.tessellationProperties._joinType=x.join,this.tessellationProperties._miterLimitCosine=l.getLimitCosine(x.miterLimit),this.tessellationProperties._roundLimitCosine=l.getLimitCosine(x.roundLimit);var p=h.getGeometry(e);this._processFeature(p,d)}}s.cleanup()},t.prototype._processFeature=function(e,t){if(e)for(var r=e.length,n=0;n<r;n++)this._processGeometry(e[n],t)},t.prototype._processGeometry=function(e,t){var r;if(n("esri-tiles-performance")&&(r=performance.now()),!(e.length<2)){for(var i,o,a=e[0],l=1;l<e.length;)(i=e[l].x-a.x)*i+(o=e[l].y-a.y)*o<1e-6?e.splice(l,1):(a=e[l],++l);if(!(e.length<2)){var h=this.tessellationProperties._lineIndexBuffer.index;this._tessellationOptions.trackDistance=this.tessellationProperties._hasPattern,this._tessellationOptions.initialDistance=0,this._tessellationOptions.thin=this._isThinLine,this._tessellationOptions.wrapDistance=65535,this._tessellationOptions.outerBisectorAutoSplitThreshold=1/3.8,this._tessellationOptions.enableOuterBisectorSplit=this.tessellationProperties._hasPattern,this._tessellationOptions.innerBisectorAutoSplitThreshold=1/3.8,this._tessellationOptions.enableInnerBisectorSplit=this.tessellationProperties._hasPattern,this.tessellationProperties._ddValues=t,s.tessellate(e,this._tessellationOptions,this._tessellationCallbacks),this._lineIndexCount+=3*(this.tessellationProperties._lineIndexBuffer.index-h),n("esri-tiles-performance")&&(u+=(performance.now()-r)/1e3,f+=this.tessellationProperties._lineIndexBuffer.index-h,c++)}}},t}(o)}.apply(null,n))||(e.exports=i)},896:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1998),r(334),r(346)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,r,n,i){void 0===r&&(r=0),void 0===n&&(n=-1),void 0===i&&(i=u),this.x=e,this.y=t,this.angle=r,this.segment=n,this.minzoom=i};t.Anchor=o;var a=function(e,t,r,i,o,a,s){void 0===o&&(o=!1),void 0===a&&(a=u),void 0===s&&(s=n.C_INFINITY),this.anchor=e,this.labelAngle=t,this.glyphAngle=r,this.page=i,this.upsideDown=o,this.minzoom=a,this.maxzoom=s},s=function(e,t,r,n,i,o,a,s,l,u){this.tl=e,this.tr=t,this.bl=r,this.br=n,this.mosaicRect=i,this.labelAngle=o,this.anchor=a,this.minzoom=s,this.maxzoom=l,this.page=u};t.PlacedSymbol=s;var l=function(e,t){this.footprint=e,this.shapes=t};t.Placement=l;var u=.5,f=function(){function e(){this.mapAngle=0,this._conflictEngine=new r.ConflictEngine}return e.prototype.reset=function(){this._conflictEngine.reset()},e.prototype.setAngle=function(e){this.mapAngle=e},e.prototype.getIconPlacement=function(e,t,o,a,f){var c=o.width/o.pixelRatio,h=o.height/o.pixelRatio,x=f.offset[0]-c/2,d=f.offset[1]-h/2,p=x+c,y=d+h,_=o.rect,v=2/o.pixelRatio,g=x-v,m=d-v,I=g+_.width/o.pixelRatio,V=m+_.height/o.pixelRatio,B=new i.Point(g,m),b=new i.Point(I,V),D=new i.Point(g,V),w=new i.Point(I,m),P=f.rotate*n.C_DEG_TO_RAD,T=1===f.rotationAlignment;if(e.segment>=0&&!T&&(P+=e.angle),0!==P){var E=Math.cos(P),M=Math.sin(P);B.rotate(E,M),b.rotate(E,M),D.rotate(E,M),w.rotate(E,M)}var z=8*f.padding,C=new i.Point(e.x,e.y),N=new r.Footprint(this.mapAngle,z,T);N.addBox(C,new r.Box(x,d,p,y),a,P,t,u,n.C_INFINITY);var S=new s(B,w,D,b,_,0,C,u,n.C_INFINITY,0),k=new l(N,[S]),A=u;return f.allowOverlap||(A=this._conflictEngine.getMinZoom(k.footprint,A)),N.minzoom=A,k},e.prototype.getTextPlacement=function(e,t,o,f,c,h,x){for(var d,p=new i.Point(e.x,e.y),y=x.rotate*n.C_DEG_TO_RAD,_=0===x.rotationAlignment,v=x.keepUpright,g=u,m=!_,I=m?0:e.angle,V=e.segment>=0&&_,B=8*x.padding,b=new r.Footprint(this.mapAngle,B,m),D=[],w=!V,P=Number.POSITIVE_INFINITY,T=Number.NEGATIVE_INFINITY,E=P,M=T,z=V?v:_&&v,C=0,N=f;C<N.length;C++){var S=N[C],k=S.glyphMosaicItem;if(k&&!k.rect.isEmpty){var A=k.rect,L=k.metrics,O=k.page;w&&(d&&d!==S.y&&(b.addBox(p,new r.Box(P,E,T,M),c,y,t,u,n.C_INFINITY),E=P=Number.POSITIVE_INFINITY,M=T=Number.NEGATIVE_INFINITY),d=S.y);var F=[];if(V){var j=.5*k.metrics.width,R=(o.x+S.x+L.left-4+j)*c;if(g=this._placeGlyph(e,g,R,h,e.segment,1,O,F),v&&(g=this._placeGlyph(e,g,R,h,e.segment,-1,O,F)),g>=2)break}else F.push(new a(p,I,I,O)),_&&v&&F.push(new a(p,I+n.C_PI,I+n.C_PI,O,!0));for(var G=S.x+o.x+L.left,U=S.y+o.y-L.top,Y=G+L.width,K=U+L.height,Z=new i.Point(G-4,U-4),H=new i.Point(Z.x+A.width,Z.y+A.height),q=new i.Point(Z.x,H.y),W=new i.Point(H.x,Z.y),J=0,X=F;J<X.length;J++){var Q=X[J],$=Z.clone(),ee=q.clone(),te=W.clone(),re=H.clone(),ne=U,ie=K,oe=Q.glyphAngle+y;if(0!==oe){var ae=Math.cos(oe),se=Math.sin(oe);$.rotate(ae,se),re.rotate(ae,se),ee.rotate(ae,se),te.rotate(ae,se)}D.push(new s($,te,ee,re,A,Q.labelAngle,Q.anchor,Q.minzoom,Q.maxzoom,Q.page)),z&&!this._legible(Q.labelAngle)||(w?(G<P&&(P=G),ne<E&&(E=ne),Y>T&&(T=Y),ie>M&&(M=ie)):Q.minzoom<2&&b.addBox(Q.anchor,new r.Box(G,ne,Y,ie),c,oe,t,Q.minzoom,Q.maxzoom))}}}if(g>=2)return null;w&&b.addBox(p,new r.Box(P,E,T,M),c,y,t,u,n.C_INFINITY);var le=new l(b,D);return x.allowOverlap||(g=this._conflictEngine.getMinZoom(le.footprint,g)),b.minzoom=g,le},e.prototype.add=function(e){this._conflictEngine.add(e.footprint)},e.prototype._legible=function(e){var t=n.radToByte(e);return t<65||t>=193},e.prototype._placeGlyph=function(e,t,r,o,s,l,u,f){var c=l,h=c<0?n.positiveMod(e.angle+n.C_PI,n.C_2PI):e.angle,x=this._legible(h),d=0;r<0&&(c*=-1,r*=-1,d=n.C_PI),c>0&&++s;var p=new i.Point(e.x,e.y),y=o[s],_=n.C_INFINITY;if(o.length<=s)return _;for(;;){var v=y.x-p.x,g=y.y-p.y,m=Math.sqrt(v*v+g*g),I=Math.max(r/m,t),V=v/m,B=g/m,b=n.positiveMod(Math.atan2(B,V)+d,n.C_2PI);if(f.push(new a(p,h,b,u,x,I,_)),I<=t)return I;p=y.clone();do{if(s+=c,o.length<=s||s<0)return I;y=o[s]}while(p.isEqual(y));var D=y.x-p.x,w=y.y-p.y,P=Math.sqrt(D*D+w*w);D*=m/P,w*=m/P,p.x-=D,p.y-=w,_=I}},e}();t.PlacementEngine=f}.apply(null,n))||(e.exports=i)},897:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(21),r(376),r(565),r(334),r(896),r(716),r(346),r(191)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u){function f(e,t){return e.iconMosaicItem&&t.iconMosaicItem?e.iconMosaicItem.page===t.iconMosaicItem.page?0:e.iconMosaicItem.page<t.iconMosaicItem.page?-1:1:e.iconMosaicItem&&!t.iconMosaicItem?1:!e.iconMosaicItem&&t.iconMosaicItem?-1:0}return function(e){function t(t,r,n,i,o,a,s,l){var u=e.call(this,t,r)||this;if(u._markerMap=new Map,u._glyphMap=new Map,u._glyphBufferDataStorage=new Map,u._sdfMarkers=!1,t.hasDataDrivenIcon!==n.isDataDriven())throw new Error("incompatible icon buffer");if(t.hasDataDrivenText!==o.isDataDriven())throw new Error("incompatible text buffer");return u._iconVertexBuffer=n,u._iconIndexBuffer=i,u._textVertexBuffer=o,u._textIndexBuffer=a,u._placementEngine=s,u._workerTileHandler=l,u}return r(t,e),Object.defineProperty(t.prototype,"markerPageMap",{get:function(){return this._markerMap},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"glyphsPageMap",{get:function(){return this._glyphMap},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sdfMarker",{get:function(){return this._sdfMarkers},enumerable:!0,configurable:!0}),t.prototype.copy=function(e,r,n,i,o){var a=new t(this.layer,this.zoom,e,r,n,i,o,this._workerTileHandler);return a.layerIndex=this.layerIndex,a.layerExtent=this.layerExtent,a._iconIndexStart=r.index,a._textIndexStart=i.index,a._iconIndexCount=0,a._textIndexCount=0,a._symbolInstances=this._symbolInstances,a._workerTileHandler=this._workerTileHandler,a._fontArray=this._fontArray,a._textLayout=this._textLayout,a._iconLayout=this._iconLayout,a._isLinePlacement=this._isLinePlacement,a._avoidEdges=this._avoidEdges,a},t.prototype.getResources=function(e,r,n){var i=this.layer,o=this.zoom,a=i.hasDataDrivenIcon,s=i.hasDataDrivenText;e&&e.setExtent(this.layerExtent);for(var l=i.getLayoutProperty("icon-image"),u=i.getLayoutProperty("text-field"),f=i.getLayoutValue("text-font",o),c=i.getLayoutValue("text-transform",o),h=[],x=[1,1,1,1],d=1,p=1,y=[1,1,1,1],_=1,v=1,g=0,m=this._features;g<m.length;g++){var I=m[g],V=I.getGeometry(e);if(V&&0!==V.length){var B=void 0;l&&(B=i.getLayoutValue("icon-image",o,I),l.isDataDriven||(B=this._replaceKeys(B,I.values)),B&&r.add(B));var b=void 0,D=!1;if(u&&(b=i.getLayoutValue("text-field",o,I),u.isDataDriven||(b=this._replaceKeys(b,I.values)),b=b.replace(/\\n/g,"\n"))){switch(c){case 2:b=b.toLowerCase();break;case 1:b=b.toUpperCase()}if(t._bidiEngine.hasBidiChar(b)){var w;w="rtl"===t._bidiEngine.checkContextual(b)?"IDNNN":"ICNNN",b=t._bidiEngine.bidiTransform(b,w,"VLYSN"),D=!0}var P=b.length;if(P>0)for(var T=0,E=f;T<E.length;T++){var M=E[T],z=n[M];z||(z=n[M]=new Set);for(var C=0;C<P;C++){var N=b.charCodeAt(C);z.add(N)}}}if(B||b){var S=i.getLayoutValue("icon-size",o,I),k=i.getLayoutValue("text-size",o,I);i.hasDataDrivenIconColor&&(x=i.getPaintValue("icon-color",o,I)),i.hasDataDrivenIconOpacity&&(d=i.getPaintValue("icon-opacity",o,I)),i.hasDataDrivenIconSize&&(p=S),i.hasDataDrivenTextColor&&(y=i.getPaintValue("text-color",o,I)),i.hasDataDrivenTextOpacity&&(_=i.getPaintValue("text-opacity",o,I)),i.hasDataDrivenTextSize&&(v=k);var A={sprite:B,label:b,rtl:D,type:I.type,geometry:V,iconSize:S,iconRotate:i.getLayoutValue("icon-rotate",o,I),ddIconValues:a?{color:x,opacity:d,size:p}:null,textSize:k,textRotate:i.getLayoutValue("text-rotate",o,I),ddTextValues:s?{color:y,opacity:_,size:v}:null};h.push(A)}}}this._symbolFeatures=h},t.prototype.processFeatures=function(e){e&&e.setExtent(this.layerExtent);var r,n,i,l,c,h=this.layer,x=this.zoom,d=this._isLinePlacement=1===h.getLayoutValue("symbol-placement",x),p=8*h.getLayoutValue("symbol-spacing",x),y=h.getLayoutProperty("icon-image"),_=h.getLayoutProperty("text-field"),v=this._workerTileHandler;if(y&&(this._iconLayout=new s.IconLayout(h,x,d),r=v.getSpriteItems(),n=this._getTranslate(!0)),_){var g=this._textLayout=new s.TextLayout(h,x,d);this._fontArray=g.fontArray;var m=.5;switch(g.anchor){case 5:case 1:case 7:m=0;break;case 6:case 2:case 8:m=1}var I=.5;switch(g.anchor){case 5:case 3:case 6:I=0;break;case 7:case 4:case 8:I=1}var V=.5;switch(g.justify){case 0:V=0;break;case 2:V=1}var B=24*g.letterSpacing,b=d?0:24*g.maxWidth,D=24*g.lineHeight,w=[24*g.offset[0],24*g.offset[1]];i=this._fontArray.map((function(e){return v.getGlyphItems(e)})),l=new u.TextShaping(i,b,D,B,w,m,I,V),c=this._getTranslate(!1)}this._iconIndexStart=this._iconIndexBuffer.index,this._textIndexStart=this._textIndexBuffer.index,this._iconIndexCount=0,this._textIndexCount=0,this._markerMap.clear(),this._glyphMap.clear();var P=[];this._symbolInstances=P;var T=this._textLayout,E=1;T&&T.size&&(E=T.size/24);for(var M=T?T.maxAngle*o.C_DEG_TO_RAD:0,z=T?8*T.size:0,C=0,N=this._symbolFeatures;C<N.length;C++){var S=N[C],k=void 0;S.sprite&&(k=r[S.sprite])&&k.sdf&&(this._sdfMarkers=!0);var A=void 0,L=S.label,O=0;if(L&&(A=l.getShaping(L,S.rtl))&&A.length>0){for(var F=1e30,j=-1e30,R=0,G=A;R<G.length;R++){var U=G[R];F=Math.min(F,U.x),j=Math.max(j,U.x)}O=(j-F+48)*E*8}for(var Y=0,K=S.geometry;Y<K.length;Y++){var Z=K[Y],H=void 0;if(d){if(A&&A.length>0&&T&&T.size){var q=8*T.size*(2+Math.min(2,4*Math.abs(T.offset[1])));t._smoothVertices(Z,q)}H=t._findAnchors(Z,p,O)}else H=3===S.type?t._findCentroid(Z):[new a.Anchor(Z[0].x,Z[0].y)];for(var W=0,J=H;W<J.length;W++){var X=J[W];X.x<0||X.x>4096||X.y<0||X.y>4096||d&&O>0&&0===T.rotationAlignment&&!t._honorsTextMaxAngle(Z,X,O,M,z)||P.push({shaping:A,line:Z,iconMosaicItem:k,anchor:X,iconSize:S.iconSize,iconRotate:S.iconRotate,ddIconValues:S.ddIconValues,textSize:S.textSize,textRotate:S.textRotate,ddTextValues:S.ddTextValues})}}}P.sort(f);for(var Q=0,$=P;Q<$.length;Q++){var ee=$[Q];this._processFeature(ee,n,c)}this._addPlacedGlyphs()},t.prototype.updateSymbols=function(){this._iconIndexStart=this._iconIndexBuffer.index,this._textIndexStart=this._textIndexBuffer.index,this._iconIndexCount=0,this._textIndexCount=0,this._markerMap.clear(),this._glyphMap.clear();var e,t,r=this.layer;r.getLayoutProperty("icon-image")&&(e=this._getTranslate(!0)),r.getLayoutProperty("text-field")&&(t=this._getTranslate(!1));for(var n=0,i=this._symbolInstances;n<i.length;n++){var o=i[n];this._processFeature(o,e,t)}this._addPlacedGlyphs()},t.prototype.assignBufferInfo=function(){},t.prototype._getTranslate=function(e){var t=this.layer.getPaintValue(e?"icon-translate":"text-translate",this.zoom);if(0!==t[0]||0!==t[1]){var r=this._placementEngine.mapAngle;if(0!==r&&0===this.layer.getPaintValue(e?"icon-translate-anchor":"text-translate-anchor",this.zoom)){var n=Math.sin(r),i=Math.cos(r);return[8*(t[0]*i-t[1]*n),8*(t[0]*n+t[1]*i)]}return[8*t[0],8*t[1]]}},t.prototype._replaceKeys=function(e,t){return e.replace(/{([^{}]+)}/g,(function(e,r){return r in t?t[r]:""}))},t.prototype._processFeature=function(e,t,r){var n=e.line,i=e.iconMosaicItem,a=e.shaping,s=e.anchor,u=this._iconLayout,f=u&&!!i,c=!0,h=1;f&&(u.size=e.iconSize,u.rotate=e.iconRotate,h=8*u.size,c=u.optional||!i);var x=this._textLayout,d=x&&a&&a.length>0,p=1,y=p,_=!0;d&&(x.size=e.textSize,x.rotate=e.textRotate,y=8*(p=x.size/24),_=x.optional||!a||0===a.length);var v,g,m=new l.Point(0,-17);if((f&&(v=this._placementEngine.getIconPlacement(s,t,i,h,u),s.minzoom>v.footprint.minzoom&&(v.footprint.minzoom=s.minzoom),v.footprint.minzoom===o.C_INFINITY&&(v=null)),v||c)&&(d&&(g=this._placementEngine.getTextPlacement(s,r,m,a,y,n,x))&&(s.minzoom>g.footprint.minzoom&&(g.footprint.minzoom=s.minzoom),g.footprint.minzoom===o.C_INFINITY&&(g=null)),g||_)){if(v&&g||(_||c?_||g?c||v||(g=null):v=null:(v=null,g=null)),v&&g&&!_&&!c){var I=Math.max(v.footprint.minzoom,g.footprint.minzoom);v.footprint.minzoom=I,g.footprint.minzoom=I}g&&(x.ignorePlacement||this._placementEngine.add(g),this._storePlacedGlyphs(g.shapes,g.footprint.minzoom,this.zoom,e.ddTextValues)),v&&(u.ignorePlacement||this._placementEngine.add(v),this._addPlacedIcons(v.shapes,v.footprint.minzoom,this.zoom,i.page,e.ddIconValues))}},t.prototype._addPlacedIcons=function(e,t,r,n,i){for(var a=Math.max(r+o.log2(t),0),s=this._iconVertexBuffer,l=this._iconIndexBuffer,u=0,f=e;u<f.length;u++){var c=f[u],h=Math.max(r+o.log2(c.minzoom),a),x=Math.min(r+o.log2(c.maxzoom),25);if(!(x<=h)){var d=c.tl,p=c.tr,y=c.bl,_=c.br,v=c.mosaicRect,g=c.labelAngle,m=c.anchor,I=s.index,V=v.x,B=v.y,b=V+v.width,D=B+v.height;s.add(m.x,m.y,d.x,d.y,V,B,g,h,x,a,i),s.add(m.x,m.y,p.x,p.y,b,B,g,h,x,a,i),s.add(m.x,m.y,y.x,y.y,V,D,g,h,x,a,i),s.add(m.x,m.y,_.x,_.y,b,D,g,h,x,a,i),l.add(I+0,I+1,I+2),l.add(I+1,I+2,I+3),this._markerMap.has(n)?this._markerMap.get(n)[1]+=6:this._markerMap.set(n,[this._iconIndexStart+this._iconIndexCount,6]),this._iconIndexCount+=2}}},t.prototype._addPlacedGlyphs=function(){var e=this,t=this._textVertexBuffer,r=this._textIndexBuffer;this._glyphBufferDataStorage.forEach((function(n,i){for(var o=0,a=n;o<a.length;o++){var s=a[o],l=t.index;t.add(s.glyphAnchor[0],s.glyphAnchor[1],s.tl[0],s.tl[1],s.xmin,s.ymin,s.labelAngle,s.minLod,s.maxLod,s.placementLod,s.ddValues),t.add(s.glyphAnchor[0],s.glyphAnchor[1],s.tr[0],s.tr[1],s.xmax,s.ymin,s.labelAngle,s.minLod,s.maxLod,s.placementLod,s.ddValues),t.add(s.glyphAnchor[0],s.glyphAnchor[1],s.bl[0],s.bl[1],s.xmin,s.ymax,s.labelAngle,s.minLod,s.maxLod,s.placementLod,s.ddValues),t.add(s.glyphAnchor[0],s.glyphAnchor[1],s.br[0],s.br[1],s.xmax,s.ymax,s.labelAngle,s.minLod,s.maxLod,s.placementLod,s.ddValues),r.add(l+0,l+1,l+2),r.add(l+1,l+2,l+3),e._glyphMap.has(i)?e._glyphMap.get(i)[1]+=6:e._glyphMap.set(i,[e._textIndexStart+e._textIndexCount,6]),e._textIndexCount+=2}})),this._glyphBufferDataStorage.clear()},t.prototype._storePlacedGlyphs=function(e,t,r,n){for(var i=Math.max(r+o.log2(t),0),a=0,s=e;a<s.length;a++){var l=s[a],u=Math.max(r+o.log2(l.minzoom),i),f=Math.min(r+o.log2(l.maxzoom),25);if(!(f<=u)){var c=l.tl,h=l.tr,x=l.bl,d=l.br,p=l.labelAngle,y=l.anchor,_=l.mosaicRect;this._glyphBufferDataStorage.has(l.page)||this._glyphBufferDataStorage.set(l.page,[]),this._glyphBufferDataStorage.get(l.page).push({glyphAnchor:[y.x,y.y],tl:[c.x,c.y],tr:[h.x,h.y],bl:[x.x,x.y],br:[d.x,d.y],xmin:_.x,ymin:_.y,xmax:_.x+_.width,ymax:_.y+_.height,labelAngle:p,minLod:u,maxLod:f,placementLod:i,ddValues:n})}}},t._findAnchors=function(e,t,r){t+=r;for(var n=0,i=e.length-1,s=0;s<i;s++)n+=l.Point.distance(e[s],e[s+1]);var u=r||t;if(n<=(u*=.5))return[];var f=u/n,c=0,h=-(t=n/Math.max(Math.round(n/t),1))/2,x=[],d=e.length-1;for(s=0;s<d;s++){for(var p=e[s],y=e[s+1],_=y.x-p.x,v=y.y-p.y,g=Math.sqrt(_*_+v*v),m=void 0;h+t<c+g;){var I=((h+=t)-c)/g,V=o.interpolate(p.x,y.x,I),B=o.interpolate(p.y,y.y,I);void 0===m&&(m=Math.atan2(v,_)),x.push(new a.Anchor(V,B,m,s,f))}c+=g}return x},t._deviation=function(e,t,r){var n=(t.x-e.x)*(r.x-t.x)+(t.y-e.y)*(r.y-t.y),i=(t.x-e.x)*(r.y-t.y)-(t.y-e.y)*(r.x-t.x);return Math.atan2(i,n)},t._honorsTextMaxAngle=function(e,t,r,n,i){for(var o=0,a=r/2,s=new l.Point(t.x,t.y),u=t.segment+1;o>-a;){if(--u<0)return!1;o-=l.Point.distance(e[u],s),s=e[u]}o+=l.Point.distance(e[u],e[u+1]);for(var f=[],c=0,h=e.length;o<a;){var x=e[u],d=u,p=void 0;do{if(++d===h)return!1;p=e[d]}while(p.isEqual(x));var y=d,_=void 0;do{if(++y===h)return!1;_=e[y]}while(_.isEqual(p));var v=this._deviation(x,p,_);for(f.push({deviation:v,distToAnchor:o}),c+=v;o-f[0].distToAnchor>i;)c-=f.shift().deviation;if(Math.abs(c)>n)return!1;o+=l.Point.distance(p,_),u=d}return!0},t._smoothVertices=function(e,t){if(!(t<=0)){var r=e.length;if(!(r<3)){var n=[],i=0;n.push(0);for(var o=1;o<r;o++)i+=l.Point.distance(e[o],e[o-1]),n.push(i);t=Math.min(t,.2*i);var a=[];a.push(e[0].x),a.push(e[0].y);var s=e[r-1].x,u=e[r-1].y,f=l.Point.sub(e[0],e[1]);f.normalize(),e[0].x+=t*f.x,e[0].y+=t*f.y,f.assignSub(e[r-1],e[r-2]),f.normalize(),e[r-1].x+=t*f.x,e[r-1].y+=t*f.y;for(o=1;o<r;o++)n[o]+=t;n[r-1]+=t;var c=.5*t;for(o=1;o<r-1;o++){for(var h=0,x=0,d=0,p=o-1;p>=0&&!(n[p+1]<n[o]-c);p--){var y=c+n[p+1]-n[o],_=n[p+1]-n[p],v=n[o]-n[p]<c?1:y/_;if(Math.abs(v)<1e-6)break;var g=v*y-.5*(b=v*v)*_,m=v*_/t,I=e[p+1],V=e[p].x-I.x,B=e[p].y-I.y;h+=m/g*(I.x*v*y+.5*b*(y*V-_*I.x)-b*v*_*V/3),x+=m/g*(I.y*v*y+.5*b*(y*B-_*I.y)-b*v*_*B/3),d+=m}for(p=o+1;p<r&&!(n[p-1]>n[o]+c);p++){y=c-n[p-1]+n[o],_=n[p]-n[p-1],v=n[p]-n[o]<c?1:y/_;if(Math.abs(v)<1e-6)break;var b;g=v*y-.5*(b=v*v)*_,m=v*_/t,I=e[p-1],V=e[p].x-I.x,B=e[p].y-I.y;h+=m/g*(I.x*v*y+.5*b*(y*V-_*I.x)-b*v*_*V/3),x+=m/g*(I.y*v*y+.5*b*(y*B-_*I.y)-b*v*_*B/3),d+=m}a.push(h/d),a.push(x/d)}a.push(s),a.push(u);for(o=0,p=0;o<r;o++)e[o].x=a[p++],e[o].y=a[p++]}}},t._findCentroid=function(e){var t=e.length-1,r=0,n=0,i=0,o=e[0].x,s=e[0].y;o>4096&&(o=4096),o<0&&(o=0),s>4096&&(s=4096),s<0&&(s=0);for(var l=1;l<t;l++){var u=e[l].x,f=e[l].y,c=e[l+1].x,h=e[l+1].y;u>4096&&(u=4096),u<0&&(u=0),f>4096&&(f=4096),f<0&&(f=0),c>4096&&(c=4096),c<0&&(c=0),h>4096&&(h=4096),h<0&&(h=0);var x=(u-o)*(h-s)-(c-o)*(f-s);r+=x*(o+u+c),n+=x*(s+f+h),i+=x}return r/=3*i,n/=3*i,isNaN(r)||isNaN(n)?[]:[new a.Anchor(r,n)]},t._bidiEngine=new n,t}(i)}.apply(null,n))||(e.exports=i)},898:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.INITIALIZED=0]="INITIALIZED",e[e.NO_DATA=1]="NO_DATA",e[e.READY=2]="READY",e[e.MODIFIED=3]="MODIFIED",e[e.INVALID=4]="INVALID"}(t.TileStatus||(t.TileStatus={}))}.apply(null,n))||(e.exports=i)}}]);
//# sourceMappingURL=74.8f93c823.chunk.js.map